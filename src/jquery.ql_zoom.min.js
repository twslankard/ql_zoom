(function(b,l){var c=b.jQuery||b.Cowboy||(b.Cowboy={}),q;c.throttle=q=function(i,g,e,j){function f(){function h(){r=+new Date;e.apply(n,m)}function o(){d=l}var n=this,k=+new Date-r,m=arguments;j&&!d&&h();d&&clearTimeout(d);if(j===l&&k>i)h();else if(g!==true)d=setTimeout(j?o:h,j===l?i-k:i)}var d,r=0;if(typeof g!=="boolean"){j=e;e=g;g=l}if(c.guid)f.guid=e.guid=e.guid||c.guid++;return f};c.debounce=function(i,g,e){return e===l?q(i,g,false):q(i,e,g!==false)}})(this);
(function(b){b.fn.imagesLoaded=function(l){var c=this.filter("img"),q=c.length;c.one("load",function(){--q<=0&&l.call(c,this)}).each(function(){if(this.complete||this.complete===undefined){var i=this.src;this.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";this.src=i}});return this};b.fn.ql_zoom=function(l){var c=b.extend({},b.fn.ql_zoom.defaultOptions,l);return this.each(function(){function q(a){var p;a=[a.pageX-e.left-~~(s/2),a.pageY-e.top-~~(t/2)];d.css({left:a[0]+
"px",top:a[1]+"px"});p=d.position();a=p.left;p=p.top;var u,v,w,x,y,z,A,B;u=a*o/k+s/(o/k)/2;v=p*n/m+s/(n/m)/2;w=s;x=t;z=y=0;A=s;B=t;if(u>o-s)w=A=k-a;if(v>n-t)B=x=m-p;if(u<0){y=Math.abs(a)+a/(o/k);u=0}if(v<0){z=Math.abs(p)+p/(n/m);v=0}a=[~~u,~~v,~~w,~~x,~~y,~~z,~~A,~~B];try{g.clearRect(0,0,400,400);g.drawImage(r[0],a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7])}catch(C){window.console&&console.dir(C)}}function i(){if(n<=m+m/10||o<=k+k/10){d.remove();r.remove()}else{f.mouseenter(function(){d.fadeIn(c.speed)}).mouseleave(function(){d.fadeOut(c.speed)}).mousemove(b.throttle(c.throttle,
q));b(window).resize(function(){e=f.offset()})}}var g,e,j=(new Date).getTime(),f=b(this),d=b("<canvas>",{id:"viewer"+j,style:"display:none; position:absolute; "+c.canvas_style}),r,h,o,n,k,m,s=parseInt(c.width,10),t=parseInt(c.height,10);(function(){if(b(this)[0].nodeName=="IMG"){f.wrapAll(b("<div>",{id:"ql_zoom_"+j,"class":"ql_zoom_container"}));f=b("#ql_zoom_"+j)}d.appendTo(f);d.css({width:c.width,height:c.height});d[0].setAttribute("width",s);d[0].setAttribute("height",t);/static/.test(void 0)&&
f.css("position","relative");f.css({overflow:"hidden"});e=f.offset();g=d.get()[0].getContext("2d");h=f.find("img").first();h.imagesLoaded(function(){m=h.height();k=h.width()});r=b("<img>",{src:!!h.data("url")+"?"+j?h.data("url"):h.attr("src"),style:"display:none;"}).appendTo(f);r.imagesLoaded(function(){n=this.height();o=this.width();i()})})()})};b.fn.ql_zoom.defaultOptions={width:"200px",height:"200px",speed:"800",throttle:50,pointer:"crosshair",canvas_style:"border:1px solid #444;"}})(jQuery);
