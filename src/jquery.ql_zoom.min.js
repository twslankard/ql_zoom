(function(b){b.fn.ql_zoom=function(w){var e=b.extend({},b.fn.ql_zoom.defaultOptions,w);return this.each(function(){var t,k,q=(new Date).getTime(),d=b(this),f=b("<canvas>",{id:"viewer"+q,style:e.canvas_style}),j,l,m,n,u,v,h=parseInt(e.width,10),i=parseInt(e.height,10),x=b("#output");(function(){if(/IMG/.test(b(this)[0].nodeName)===true){d.wrapAll(b("<div>",{id:"ql_zoom_"+q,"class":"ql_zoom_container"}));d=b("#ql_zoom_"+q)}l=d.find("img").first();v=l.height();u=l.width();j=b("<img>",{src:l.data("url"),
style:"display:none;"}).appendTo(d);j.imagesLoaded(function(){n=j.height();m=j.width()});f.appendTo(d);f.css({width:e.width,height:e.height});/static/.test(void 0)&&d.css("position","relative");d.css({overflow:"hidden",cursor:e.pointer});k=d.offset();t=f.get()[0].getContext("2d")})();d.mouseenter(function(){f.fadeIn(e.speed)}).mouseleave(function(){f.fadeOut(e.speed)}).mousemove(b.throttle(e.throttle,function(g){var c,a;a=h;c=i;g=[g.pageX-k.left-~~(a/2),g.pageY-k.top-~~(c/2)];f.css({left:g[0]+"px",
top:g[1]+"px"});c=f.position();var o,p,r,s;a=c.left*m/u+h/2;c=c.top*n/v+i/2;o=h;p=i;r=400;s=200;if(a<0)a=0;if(c<0)c=0;if(a>m-h){o=m-a;r=(h-(h-o))*1.5}if(c>n-i){p=n-c;s=(i-(i-p))*1.5}a=[~~a,~~c,~~o,~~p,0,0,~~r,~~s];x.html("sx = "+a[0]+", sy ="+a[1]+", sW = "+a[2]+", sH ="+a[3]+", dx = "+a[4]+", dy ="+a[5]+", dW = "+a[6]+", dH ="+a[7]+", pageX ="+g[0]+", pageY ="+g[1]);try{t.drawImage(j[0],a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7])}catch(y){console.dir(y)}}));b(window).resize(function(){k=d.offset()})})};
b.fn.ql_zoom.defaultOptions={width:"200px",height:"200px",speed:"800",throttle:50,pointer:"crosshair",canvas_style:"display:none; position:absolute; border:1px solid #444;"}})(jQuery);
